const h="https://api.ethos.network/api/v2",v="ethoscan@1.0.0";async function p(e){try{const t=await fetch(`${h}/users/by/address`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"*/*","X-Ethos-Client":v},body:JSON.stringify({addresses:[e]})});if(!t.ok)return t.status===404?{success:!1,error:{message:"Address not found in Ethos network",statusCode:404}}:t.status===400?{success:!1,error:{message:"Invalid Ethereum address format",statusCode:400}}:{success:!1,error:{message:`API request failed with status ${t.status}`,statusCode:t.status}};const r=await t.json();return!r||r.length===0?{success:!1,error:{message:"No profile data returned from API",statusCode:404}}:{success:!0,data:r[0]}}catch(t){return{success:!1,error:{message:t instanceof Error?t.message:"Network request failed",statusCode:0}}}}function m(e){return typeof e!="number"||isNaN(e)||!isFinite(e)?0:Math.floor(Math.max(0,Math.min(2800,e)))}function g(e){return e<800?{level:"untrusted",color:"#b72b38"}:e<1200?{level:"questionable",color:"#C29010"}:e<1400?{level:"neutral",color:"#C1C0B6"}:e<1600?{level:"known",color:"#7C8DA8"}:e<1800?{level:"established",color:"#4E86B9"}:e<2e3?{level:"reputable",color:"#2E7BC3"}:e<2200?{level:"exemplary",color:"#427B56"}:e<2400?{level:"distinguished",color:"#127f31"}:e<2600?{level:"revered",color:"#836DA6"}:{level:"renowned",color:"#7A5EAF"}}function E(e){const t=m(e.score),{level:r,color:a}=g(t),n=e.status==="active",l={negative:e.stats?.review?.received?.negative??0,neutral:e.stats?.review?.received?.neutral??0,positive:e.stats?.review?.received?.positive??0},s=u=>u&&u.trim()!==""?u:void 0;return{score:t,level:r,color:a,isActive:n,displayName:s(e.displayName),username:s(e.username),avatarUrl:s(e.avatarUrl),reviewStats:l,links:{profile:e.links.profile,scoreBreakdown:e.links.scoreBreakdown}}}function b(e){return!e||typeof e!="string"||!e.startsWith("0x")||e.length!==42?!1:/^0x[0-9a-fA-F]{40}$/.test(e)}function w(e){try{const r=new URL(e).hostname.toLowerCase();return r==="etherscan.io"||r.endsWith(".etherscan.io")?"etherscan":r==="blockscan.com"||r.endsWith(".blockscan.com")?"blockscan":r==="debank.com"?"debank":null}catch{return null}}function A(e){const t=w(e);if(!t)return{address:null,explorer:null,isValid:!1};try{const a=new URL(e).pathname;let n=null;if(t==="etherscan"||t==="blockscan"){const s=a.match(/\/address\/([^\/\?#]+)/);s&&s[1]&&(n=s[1])}else if(t==="debank"){const s=a.match(/\/profile\/([^\/\?#]+)/);s&&s[1]&&(n=s[1])}if(!n)return{address:null,explorer:t,isValid:!1};const l=b(n);return{address:l?n:null,explorer:t,isValid:l}}catch{return{address:null,explorer:t,isValid:!1}}}let i=null,d=null,o=null;async function c(){const e=A(window.location.href);if(e.isValid&&e.address){if(e.address===i)return;i=e.address,console.log(`Address detected: ${e.address} on ${e.explorer}`);const t=await p(e.address);if(t.success){const r=E(t.data);console.log("Normalized Ethos profile:",r)}else console.error("Failed to fetch Ethos profile:",t.error)}else i!==null&&(i=null,console.log("No valid Ethereum address found in URL"))}function k(){o=()=>{c()},window.addEventListener("popstate",o),d=window.setInterval(()=>{c()},500)}function C(){o!==null&&(window.removeEventListener("popstate",o),o=null),d!==null&&(clearInterval(d),d=null)}function f(){c(),k()}window.addEventListener("beforeunload",C);document.readyState==="loading"?document.addEventListener("DOMContentLoaded",f):f();
