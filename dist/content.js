(function(){"use strict";const I="https://api.ethos.network/api/v2",L="ethoscan@1.0.0";async function P(e){try{const t=await fetch(`${I}/users/by/address`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"*/*","X-Ethos-Client":L},body:JSON.stringify({addresses:[e]})});if(!t.ok)return t.status===404?{success:!1,error:{message:"Address not found in Ethos network",statusCode:404}}:t.status===400?{success:!1,error:{message:"Invalid Ethereum address format",statusCode:400}}:{success:!1,error:{message:`API request failed with status ${t.status}`,statusCode:t.status}};const o=await t.json();return!o||o.length===0?{success:!1,error:{message:"No profile data returned from API",statusCode:404}}:{success:!0,data:o[0]}}catch(t){return{success:!1,error:{message:t instanceof Error?t.message:"Network request failed",statusCode:0}}}}function R(e){return typeof e!="number"||isNaN(e)||!isFinite(e)?0:Math.floor(Math.max(0,Math.min(2800,e)))}function D(e){return e<800?{level:"untrusted",color:"#b72b38"}:e<1200?{level:"questionable",color:"#C29010"}:e<1400?{level:"neutral",color:"#C1C0B6"}:e<1600?{level:"known",color:"#7C8DA8"}:e<1800?{level:"established",color:"#4E86B9"}:e<2e3?{level:"reputable",color:"#2E7BC3"}:e<2200?{level:"exemplary",color:"#427B56"}:e<2400?{level:"distinguished",color:"#127f31"}:e<2600?{level:"revered",color:"#836DA6"}:{level:"renowned",color:"#7A5EAF"}}function W(e){const t=R(e.score),{level:o,color:n}=D(t),s=e.status==="active",r={negative:e.stats?.review?.received?.negative??0,neutral:e.stats?.review?.received?.neutral??0,positive:e.stats?.review?.received?.positive??0},c=i=>i&&i.trim()!==""?i:void 0;return{score:t,level:o,color:n,isActive:s,displayName:c(e.displayName),username:c(e.username),avatarUrl:c(e.avatarUrl),reviewStats:r,links:{profile:e.links.profile,scoreBreakdown:e.links.scoreBreakdown}}}function f(e){if(!document.contains(e))return!1;const t=window.getComputedStyle(e);if(t.display==="none"||t.visibility==="hidden")return!1;const o=e.getBoundingClientRect();if(o.width===0||o.height===0)return!1;let n=e.parentElement;for(;n;){const s=window.getComputedStyle(n);if(s.display==="none"||s.visibility==="hidden")return!1;n=n.parentElement}return!0}function N(e,t=3e3){return new Promise(o=>{const n=document.querySelector(e);if(n&&f(n)){o(n);return}const s=new MutationObserver(()=>{const c=document.querySelector(e);c&&f(c)&&(s.disconnect(),clearTimeout(r),o(c))});s.observe(document.body,{childList:!0,subtree:!0});const r=setTimeout(()=>{s.disconnect(),o(null)},t)})}function F(e){switch(e){case"etherscan":return{explorer:e,selectors:[{query:".d-flex.gap-2.noindex-section",strategy:"before"},{query:".noindex-section",strategy:"before"},{query:".container.py-3",strategy:"after"}],fallbackSelector:"main#content",maxRetries:3};case"blockscout":return{explorer:e,selectors:[{query:"div.css-82b7an",strategy:"append"},{query:"h1.chakra-heading",strategy:"after",validator:t=>{const o=t.textContent?.trim().toLowerCase()||"";if(o==="address details"||o.startsWith("address details")){const s=t.closest("div[class^='css-']")?.nextElementSibling;return s?.classList.contains("css-82b7an")||s?.querySelector(".chakra-tag__root")!==null}return!1}},{query:".address-entity",strategy:"after"}],fallbackSelector:"main",waitForDynamicContent:!0,maxRetries:5};case"debank":return{explorer:e,selectors:[{query:'[class*="HeaderInfo_leftContent"]',strategy:"append"},{query:'[class*="HeaderInfo_userInfoContainer"]',strategy:"append"}],fallbackSelector:"main",waitForDynamicContent:!0,maxRetries:5};case"routescan":return{explorer:e,selectors:[{query:'[data-testid="address-qr-code-button"]',strategy:"after"},{query:'button[aria-label="Show Links"]',strategy:"before"},{query:".flex.items-center.flex-wrap.gap-2",strategy:"append"}],fallbackSelector:"main",waitForDynamicContent:!0,maxRetries:5};default:return{explorer:e,selectors:[],maxRetries:3}}}async function V(e){const t=F(e);console.group(`[Ethoscan] Finding anchor for ${e}`);for(const n of t.selectors){console.log("Trying selector:",n.query);let s=null;if(t.waitForDynamicContent?s=await N(n.query,3e3):s=document.querySelector(n.query),s){const r=f(s);if(console.log("Element found:",!0),console.log("Validation passed:",r),r){if(n.validator&&!n.validator(s)){console.log("Custom validator failed");continue}return console.log("✓ Primary selector matched (high confidence)"),console.groupEnd(),{element:s,insertionStrategy:n.strategy,confidence:"high"}}}else console.log("Element found:",!1)}if(t.fallbackSelector){console.log("Trying fallback selector:",t.fallbackSelector);let n=null;if(t.waitForDynamicContent?n=await N(t.fallbackSelector,3e3):n=document.querySelector(t.fallbackSelector),n&&f(n))return console.log("✓ Fallback selector matched (medium confidence)"),console.groupEnd(),{element:n,insertionStrategy:"prepend",confidence:"medium"}}const o=["main","body"];for(const n of o){console.log("Trying generic selector:",n);const s=document.querySelector(n);if(s&&f(s))return console.warn("⚠ Using generic selector (low confidence)"),console.groupEnd(),{element:s,insertionStrategy:"prepend",confidence:"low"}}return console.error("✗ No anchor point found"),console.groupEnd(),null}function M(e){const t=e.replace("#",""),o=parseInt(t.substr(0,2),16)/255,n=parseInt(t.substr(2,2),16)/255,s=parseInt(t.substr(4,2),16)/255,[r,c,i]=[o,n,s].map(d=>d<=.03928?d/12.92:Math.pow((d+.055)/1.055,2.4));return .2126*r+.7152*c+.0722*i}function C(e){return M(e)>.179?"#000000":"#ffffff"}const u="ethoscan-widget",A="data-ethoscan-id";function $(e,t,o,n,s){requestAnimationFrame(()=>{y();const r=e?j(e,n):X(s||"Unable to load Ethos profile");r.setAttribute(A,o.toLowerCase()),r.setAttribute("data-ethoscan-explorer",n),Y(r,t)})}function j(e,t){if(t==="etherscan"){const o=a("div",`${u} ${u}--etherscan`),n=G(e);return o.appendChild(n),o}else if(t==="debank"){const o=a("div",`${u} ${u}--debank`),n=z(e);return o.appendChild(n),o}else if(t==="blockscout"){const o=a("div",`${u} ${u}--blockscout`),n=J(e);return o.appendChild(n),o}else if(t==="routescan"){const o=a("div",`${u} ${u}--routescan`),n=K(e);return o.appendChild(n),o}else{const o=a("div",u),n=O(e),s=U(e);return o.appendChild(n),o.appendChild(s),o}}function O(e){const t=a("div","ethoscan-widget__header"),o=a("span","ethoscan-widget__title","Ethos Reputation"),n=document.createElement("a");return n.className="ethoscan-widget__link",n.href=e.links.profile,n.target="_blank",n.rel="noopener noreferrer",n.textContent="View Profile",t.appendChild(o),t.appendChild(n),t}function U(e){const t=a("div","ethoscan-widget__content"),o=B(e),n=H(e);return t.appendChild(o),t.appendChild(n),t}function B(e){const t=a("div","ethoscan-widget__score-section"),o=a("div","ethoscan-widget__score");o.style.color=e.color,o.style.textShadow="0 0 8px rgba(255, 255, 255, 0.9), 0 0 2px rgba(0, 0, 0, 0.3)",o.textContent=e.score.toString();const n=a("div","ethoscan-widget__level");return n.style.backgroundColor=e.color,n.style.color=C(e.color),n.textContent=e.level,t.appendChild(o),t.appendChild(n),t}function H(e){const t=a("div","ethoscan-widget__stats"),o=e.reviewStats.positive,n=e.reviewStats.neutral,s=e.reviewStats.negative,r=b(o.toString(),"Positive"),c=b(n.toString(),"Neutral"),i=b(s.toString(),"Negative");return t.appendChild(r),t.appendChild(c),t.appendChild(i),t}function b(e,t){const o=a("div","ethoscan-widget__stat"),n=a("span","ethoscan-widget__stat-value",e),s=a("span","ethoscan-widget__stat-label",t);return o.appendChild(n),o.appendChild(s),o}function G(e){const t=a("div","ethoscan-widget__etherscan-container"),o=a("span","ethoscan-widget__etherscan-label","Ethos Score:"),n=a("span","ethoscan-widget__etherscan-score");n.style.color=e.color,n.textContent=e.score.toString();const s=a("span","ethoscan-widget__etherscan-level");s.style.backgroundColor=e.color,s.style.color=C(e.color),s.textContent=e.level;const r=a("span","ethoscan-widget__etherscan-stats"),c=document.createElement("span");c.className="ethoscan-widget__etherscan-stats-positive",c.textContent=`${e.reviewStats.positive} Positive`;const i=document.createElement("span");i.className="ethoscan-widget__etherscan-stats-neutral",i.textContent=`${e.reviewStats.neutral} Neutral`;const d=document.createElement("span");d.className="ethoscan-widget__etherscan-stats-negative",d.textContent=`${e.reviewStats.negative} Negative`,r.appendChild(c),r.appendChild(document.createTextNode(" · ")),r.appendChild(i),r.appendChild(document.createTextNode(" · ")),r.appendChild(d);const l=document.createElement("a");return l.className="ethoscan-widget__etherscan-link",l.href=e.links.profile,l.target="_blank",l.rel="noopener noreferrer",l.textContent="View Profile",t.appendChild(o),t.appendChild(n),t.appendChild(s),t.appendChild(r),t.appendChild(l),t}function z(e){const t=a("div","ethoscan-widget__debank-container"),o=a("div","ethoscan-widget__debank-divider"),n=a("div","ethoscan-widget__debank-item"),s=a("div","ethoscan-widget__debank-title","Ethos Score"),r=a("div","ethoscan-widget__debank-value");r.style.color=e.color,r.textContent=e.score.toString(),n.appendChild(s),n.appendChild(r);const c=a("div","ethoscan-widget__debank-item"),i=a("div","ethoscan-widget__debank-title","Level"),d=a("div","ethoscan-widget__debank-value");d.style.color=e.color,d.textContent=e.level,c.appendChild(i),c.appendChild(d);const l=a("div","ethoscan-widget__debank-item"),p=a("div","ethoscan-widget__debank-title","Reviews"),g=a("div","ethoscan-widget__debank-value");g.style.fontSize="12px",g.style.fontWeight="400";const k=document.createElement("span");k.className="ethoscan-widget__debank-stats-positive",k.textContent=`${e.reviewStats.positive} Positive`;const E=document.createElement("span");E.className="ethoscan-widget__debank-stats-neutral",E.textContent=`${e.reviewStats.neutral} Neutral`;const x=document.createElement("span");x.className="ethoscan-widget__debank-stats-negative",x.textContent=`${e.reviewStats.negative} Negative`,g.appendChild(k),g.appendChild(document.createTextNode(" · ")),g.appendChild(E),g.appendChild(document.createTextNode(" · ")),g.appendChild(x),l.appendChild(p),l.appendChild(g);const h=document.createElement("a");return h.className="ethoscan-widget__debank-link",h.href=e.links.profile,h.target="_blank",h.rel="noopener noreferrer",h.textContent="View Profile →",h.style.fontSize="12px",h.style.color="rgb(139, 147, 167)",h.style.textDecoration="none",h.style.alignSelf="center",t.appendChild(o),t.appendChild(n),t.appendChild(c),t.appendChild(l),t.appendChild(h),t}function J(e){const t=a("div","ethoscan-widget__blockscout-container"),o=a("div","ethoscan-widget__blockscout-divider"),n=a("span","ethoscan-widget__blockscout-label","Ethos Score:"),s=a("span","ethoscan-widget__blockscout-score");s.style.color=e.color,s.textContent=e.score.toString();const r=a("span","ethoscan-widget__blockscout-level");r.style.backgroundColor=e.color,r.style.color=C(e.color),r.textContent=e.level;const c=a("span","ethoscan-widget__blockscout-stats"),i=document.createElement("span");i.className="ethoscan-widget__blockscout-stats-positive",i.textContent=`${e.reviewStats.positive} Positive`;const d=document.createElement("span");d.className="ethoscan-widget__blockscout-stats-neutral",d.textContent=`${e.reviewStats.neutral} Neutral`;const l=document.createElement("span");l.className="ethoscan-widget__blockscout-stats-negative",l.textContent=`${e.reviewStats.negative} Negative`,c.appendChild(i),c.appendChild(document.createTextNode(" · ")),c.appendChild(d),c.appendChild(document.createTextNode(" · ")),c.appendChild(l);const p=document.createElement("a");return p.className="ethoscan-widget__blockscout-link",p.href=e.links.profile,p.target="_blank",p.rel="noopener noreferrer",p.textContent="View Profile",t.appendChild(o),t.appendChild(n),t.appendChild(s),t.appendChild(r),t.appendChild(c),t.appendChild(p),t}function K(e){const t=a("div","ethoscan-widget__routescan-container"),o=a("span","ethoscan-widget__routescan-label","Ethos Score:"),n=a("span","ethoscan-widget__routescan-score");n.style.color=e.color,n.textContent=e.score.toString();const s=a("span","ethoscan-widget__routescan-level");s.style.backgroundColor=e.color,s.style.color=C(e.color),s.textContent=e.level;const r=a("span","ethoscan-widget__routescan-stats"),c=document.createElement("span");c.className="ethoscan-widget__routescan-stats-positive",c.textContent=`${e.reviewStats.positive} Positive`;const i=document.createElement("span");i.className="ethoscan-widget__routescan-stats-neutral",i.textContent=`${e.reviewStats.neutral} Neutral`;const d=document.createElement("span");d.className="ethoscan-widget__routescan-stats-negative",d.textContent=`${e.reviewStats.negative} Negative`,r.appendChild(c),r.appendChild(document.createTextNode(" · ")),r.appendChild(i),r.appendChild(document.createTextNode(" · ")),r.appendChild(d);const l=document.createElement("a");return l.className="ethoscan-widget__routescan-link",l.href=e.links.profile,l.target="_blank",l.rel="noopener noreferrer",l.textContent="View Profile",t.appendChild(o),t.appendChild(n),t.appendChild(s),t.appendChild(r),t.appendChild(l),t}function X(e){const t=a("div",`${u} ${u}--error`),o=a("span","ethoscan-widget__error-icon","⚠"),n=a("span","ethoscan-widget__error-message",e);return t.appendChild(o),t.appendChild(n),t}function a(e,t,o){const n=document.createElement(e);return n.className=t,o&&(n.textContent=o),n}function Y(e,t){const{element:o,insertionStrategy:n}=t;switch(n){case"after":o.insertAdjacentElement("afterend",e);break;case"before":o.insertAdjacentElement("beforebegin",e);break;case"prepend":o.insertAdjacentElement("afterbegin",e);break;case"append":o.insertAdjacentElement("beforeend",e);break;default:console.error("[Ethoscan] Unknown insertion strategy:",n)}}function y(){const e=document.querySelectorAll(`.${u}`),t=document.querySelectorAll(`section[${A}]`);e.forEach(n=>{n.remove()}),t.forEach(n=>{n.remove()});const o=e.length+t.length;o>0&&console.log(`[Ethoscan] Removed ${o} existing widget(s)`)}const S={etherscan:!0,blockscout:!0,debank:!0,routescan:!0},T="settings:explorers";async function Q(){try{return chrome.runtime?.id&&(await chrome.storage.sync.get(T))[T]||S}catch{return S}}function Z(e){return!e||typeof e!="string"||!e.startsWith("0x")||e.length!==42?!1:/^0x[0-9a-fA-F]{40}$/.test(e)}function ee(e){try{const o=new URL(e).hostname.toLowerCase();return o==="routescan.io"||o.endsWith(".routescan.io")?"routescan":o==="etherscan.io"||o.endsWith(".etherscan.io")||o.endsWith("scan.com")||o.endsWith("scan.org")||o.endsWith("scan.io")?"etherscan":o==="blockscout.com"||o.endsWith(".blockscout.com")?"blockscout":o==="debank.com"?"debank":null}catch{return null}}function te(e){const t=ee(e);if(!t)return{address:null,explorer:null,isValid:!1};try{const n=new URL(e).pathname;let s=null;if(t==="etherscan"||t==="blockscout"||t==="routescan"){const c=n.match(/\/address\/([^\/\?#]+)/);c&&c[1]&&(s=c[1])}else if(t==="debank"){const c=n.match(/\/profile\/([^\/\?#]+)/);c&&c[1]&&(s=c[1])}if(!s)return{address:null,explorer:t,isValid:!1};const r=Z(s);return{address:r?s:null,explorer:t,isValid:r}}catch{return{address:null,explorer:t,isValid:!1}}}let m=null,w=null,v=null;async function _(){const e=te(window.location.href);if(e.isValid&&e.address&&e.explorer){if(!(await Q())[e.explorer]){m!==null&&(m=null,y(),console.log(`[Ethoscan] Explorer ${e.explorer} is disabled in settings`));return}if(e.address===m)return;m=e.address,console.log(`[Ethoscan] Address detected: ${e.address} on ${e.explorer}`);const o=await V(e.explorer);if(!o){console.error(`[Ethoscan] Failed to find DOM anchor point for ${e.explorer}`);return}console.log(`[Ethoscan] Found anchor point with ${o.confidence} confidence`);const n=await P(e.address);if(n.success){const s=W(n.data);console.log("[Ethoscan] Rendering widget for:",e.address),$(s,o,e.address,e.explorer)}else console.error("[Ethoscan] API Error:",n.error),$(null,o,e.address,e.explorer,n.error.message)}else m!==null&&(m=null,y(),console.log("[Ethoscan] Cleaned up widgets - no valid address"))}function ne(){v=()=>{_()},window.addEventListener("popstate",v),w=window.setInterval(()=>{_()},500)}function oe(){v!==null&&(window.removeEventListener("popstate",v),v=null),w!==null&&(clearInterval(w),w=null)}try{chrome.runtime?.id&&chrome.runtime.onMessage.addListener(e=>{e.type==="SETTINGS_UPDATED"&&_()})}catch{}function q(){try{if(!chrome.runtime?.id)return;_(),ne()}catch{}}window.addEventListener("beforeunload",oe),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",q):q()})();
